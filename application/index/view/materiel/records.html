{include file="./static/public_template/dxheader.html"/}
<link rel="stylesheet" href="{:TEMPLATE}dist/css/AdminLTE.min.css">

<section class="content">
	<div class="row">
		<div class="col-md-6">
			<!-- AREA CHART -->
			<!--
	   <div class="box box-primary">
	   <div class="box-header with-border">
	   <h3 class="box-title">Area Chart</h3>

	   <div class="box-tools pull-right">
	   <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
	   </button>
	   <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
	   </div>
	   </div>
	   <div class="box-body chart-responsive">
	   <div class="chart" id="revenue-chart" style="height: 300px;"></div>
	   </div>
	   </div>
			-->
			<!-- /.box -->

			<!-- DONUT CHART -->
			<!--
	   <div class="box box-danger">
	   <div class="box-header with-border">
	   <h3 class="box-title">Donut Chart</h3>

	   <div class="box-tools pull-right">
	   <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
	   </button>
	   <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
	   </div>
	   </div>
	   <div class="box-body chart-responsive">
	   <div class="chart" id="sales-chart" style="height: 300px; position: relative;"></div>
	   </div>
	   </div>
			-->
			<!-- /.box -->

		</div>
		<!-- /.col (LEFT) -->
		<div class="col-md-12">
			<!-- LINE CHART -->
			<div class="box box-info">
				<div class="box-header with-border">
					<h3 class="box-title">线状图</h3>
					<select id="year" class="map">
						<option selected="selected" value="0">请选择</option>
						<?php $curYear = date("Y");?>
						<?php for($i=$curYear;$i>$curYear-3;$i--):?>
						<option value="{$i}">{$i}</option>
						<?php  endfor;?>
					</select>
					<select id="materiels" class="map">
						<option selected="selected"  value="0">请选择</option>
						{foreach name="materiels" item="k"}
						<option value="{$k.materiel_model_id}">{$k.model_name}</option>
						{/foreach}
					</select>

					<a style="margin-left:10px" id="export"  href="javascript:void(0)">导出所有</a>
					<div class="box-tools pull-right">
						<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
						</button>
						<button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
					</div>
				</div>
				<div class="box-body chart-responsive">
					<div class="chart" id="line-chart" style="height: 300px;"></div>
				</div>
				<!-- /.box-body -->
			</div>
			<!-- /.box -->

			<!-- BAR CHART -->
			<!--
	   <div class="box box-success">
	   <div class="box-header with-border">
	   <h3 class="box-title">Bar Chart</h3>

	   <div class="box-tools pull-right">
	   <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
	   </button>
	   <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
	   </div>
	   </div>
	   <div class="box-body chart-responsive">
	   <div class="chart" id="bar-chart" style="height: 300px;"></div>
	   </div>
	   </div>
			-->
			<!-- /.box -->

		</div>
		<!-- /.col (RIGHT) -->
	</div>
	<!-- /.row -->

</section>
<!-- /.content -->
</div>
<!-- /.content-wrapper -->
<footer class="main-footer">
	<div class="pull-right hidden-xs">
	</div>
</footer>

<!-- Control Sidebar -->
<!-- Add the sidebar's background. This div must be placed
	immediately after the control sidebar -->
	<div class="control-sidebar-bg"></div>
	</div>
	<!-- ./wrapper -->

	<!-- jQuery 2.2.3 -->
	<script src="{:TEMPLATE}plugins/jQuery/jquery-2.2.3.min.js"></script>
	<!-- Bootstrap 3.3.6 -->
	<script src="{:TEMPLATE}bootstrap/js/bootstrap.min.js"></script>
	<!-- Morris.js charts -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
	<script src="{:TEMPLATE}plugins/morris/morris.min.js"></script>
	<!-- FastClick -->
	<script src="{:TEMPLATE}plugins/fastclick/fastclick.js"></script>
	<!-- AdminLTE App -->
	<!-- AdminLTE for demo purposes -->
	<script src="{:TEMPLATE}dist/js/demo.js"></script>
	<!-- page script -->
	<script>
		$("#export").click(function(){
			var curYear = $("#year").val();
			window.open("/index/materiel/consumeExport/year/"+curYear);
		})
		$(function () {
			"use strict";

			// AREA CHART
			/*
			var area = new Morris.Area({
				element: 'revenue-chart',
				resize: true,
				data: [
					{y: '2011 Q1', item1: 2666, item2: 2666},
					{y: '2011 Q2', item1: 2778, item2: 2294},
					{y: '2011 Q3', item1: 4912, item2: 1969},
					{y: '2011 Q4', item1: 3767, item2: 3597},
					{y: '2012 Q1', item1: 6810, item2: 1914},
					{y: '2012 Q2', item1: 5670, item2: 4293},
					{y: '2012 Q3', item1: 4820, item2: 3795},
					{y: '2012 Q4', item1: 15073, item2: 5967},
					{y: '2013 Q1', item1: 10687, item2: 4460},
					{y: '2013 Q2', item1: 8432, item2: 5713}
				],
				xkey: 'y',
				ykeys: ['item1', 'item2'],
				labels: ['Item 1', 'Item 2'],
				lineColors: ['#a0d0e0', '#3c8dbc'],
				hideHover: 'auto'
			});

			 */
			// LINE CHART
			
			/*
			var line = new Morris.Line({
				element: 'line-chart',
				resize: true,
				data: [
					{y: '2011 Q1', item1: 2666},
					{y: '2011 Q2', item1: 2778},
					{y: '2011 Q3', item1: 4912},
					{y: '2011 Q4', item1: 3767},
					{y: '2012 Q1', item1: 6810},
					{y: '2012 Q2', item1: 5670},
					{y: '2012 Q3', item1: 4820},
					{y: '2012 Q4', item1: 15073},
					{y: '2013 Q1', item1: 10687},
					{y: '2013 Q2', item1: 8432}
				],
				xkey: 'y',
				ykeys: ['item1'],
				labels: ['Item 1'],
				lineColors: ['#3c8dbc'],
				hideHover: 'auto'
			});
			*/
			var datas = <?=json_encode($data);?>;
			var materiels= <?=json_encode($materiels);?>;
			var curYear = <?php echo date("Y",time());?>;
			var curMateriel = <?php if(!empty($materiels)):?> <?php reset($materiels); $cur = current($materiels); echo $cur['materiel_model_id'] ;?> <?php else: echo "false";?> <?php endif;?>;
				
			var line = null;

			function cover(num){
				if(num<10){
					return "0"+num;
				}
				else{
					return num;
				}
			}


			$(".map").change(function(){
				var curYear = $("#year").val();
				var curMateriel= $("#materiels").val();


				if(curYear == 0 || curMateriel == 0)
					return false;
				var temp = [];
				var p= null;
				for(var i=1;i<13;i++){
					p = curYear+cover(i);

					if(datas[p] !== undefined){
						if(datas[p][curMateriel] !== undefined){
							temp.push({
								y:p,
								item1: datas[p][curMateriel],
								});
						}
						else{
							temp.push({
								y:p,
								item1: 0,
								});
						}
					}
					else{
						temp.push({
							y:p,
							item1: 0,
							});
					}
				}


				line = new Morris.Line({
					element: 'line-chart',
					resize: true,
					data: temp,
					xkey: 'y',
					ykeys: ['item1'],
					labels: ['数量'],
					lineColors: ['#3c8dbc'],
					hideHover: 'auto'
				});
			});

			//DONUT CHART
			/*
			var donut = new Morris.Donut({
				element: 'sales-chart',
				resize: true,
				colors: ["#3c8dbc", "#f56954", "#00a65a"],
				data: [
					{label: "Download Sales", value: 12},
					{label: "In-Store Sales", value: 30},
					{label: "Mail-Order Sales", value: 20}
				],
				hideHover: 'auto'
			});
			//BAR CHART
			var bar = new Morris.Bar({
				element: 'bar-chart',
				resize: true,
				data: [
					{y: '2006', a: 100, b: 90},
					{y: '2007', a: 75, b: 65},
					{y: '2008', a: 50, b: 40},
					{y: '2009', a: 75, b: 65},
					{y: '2010', a: 50, b: 40},
					{y: '2011', a: 75, b: 65},
					{y: '2012', a: 100, b: 90}
				],
				barColors: ['#00a65a', '#f56954'],
				xkey: 'y',
				ykeys: ['a', 'b'],
				labels: ['CPU', 'DISK'],
				hideHover: 'auto'
			});
			 */
		});
	</script>
{include file="./static/public_template/footer.html"/}
	</body>
	</html>
